nexus.prototype={mask:null,form:null,code_boxes:[],workspace:null,code_boxes_container:null,preview_container:null,preview_frame:null,resize_bar:null,"interface":null,catch_save:function(){document.addEventListener("keydown",function(e){83==e.keyCode&&(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)&&(e.preventDefault(),nexus.prototype.save(),document.querySelector("#download_btn").click())},!1)},catch_open:function(){document.addEventListener("keydown",function(e){79==e.keyCode&&(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)&&(e.preventDefault(),document.querySelector("#open_btn").click())},!1)},code_box:function(e){e=e||"html";var t=document.createElement("div");t.language=e,t.className="code_box no_select "+e;var o=t.appendChild(document.createElement("label"));o.className="code_box_header no_select action";var n=o.appendChild(document.createElement("span"));n.className="code_box_title",n.innerHTML=e;var r=o.appendChild(document.createElement("input"));r.type="checkbox",r.className="code_box_toggler nexus",r.checked="checked",r.onchange=nexus.prototype.resize_code_boxes;var s=t.appendChild(document.createElement("div"));return s.className="code_area",t.editor=ace.edit(s),t.editor.$blockScrolling=1/0,t.editor.setValue(nexus.prototype.settings.editors.languages[e].default_value||""),t.editor.setTheme(nexus.prototype.settings.editors.theme),t.editor.on("change",nexus.prototype.show_preview),t.editor.setShowPrintMargin(!1),t.editor.setDisplayIndentGuides(nexus.prototype.settings.editors.show_indent_guides),t.editor.getSession().setMode(nexus.prototype.settings.editors.languages[e].session||"ace/mode/"+e),t.value=function(){return this.editor.getValue()},t.focus=function(){this.editor.focus()},t.set_value=function(e){this.editor.setValue(e,-1)},t.refresh=function(e){this.editor.resize()},t.collapse=function(){this.querySelector(".code_box_toggler").checked=!1,nexus.prototype.resize_code_boxes()},t.expand=function(){this.querySelector(".code_box_toggler").checked=!0,nexus.prototype.resize_code_boxes()},t.toggle=nexus.prototype.resize_code_boxes,nexus.prototype.code_boxes.push(t),t},construct:function(){nexus.prototype.mask=document.body.appendChild(document.createElement("div")),nexus.prototype.mask.id="mask",nexus.prototype.mask.className="nexus mask",nexus.prototype.mask.onclick=nexus.prototype.hide_all_menus,document.querySelector("#color_converter_btn").onclick=function(){nexus.prototype.hide_all_menus(),nexus.show_popup({url:"color_converter.html"})},document.querySelector("#base64_encoder_btn").onclick=function(){nexus.prototype.hide_all_menus(),nexus.show_popup({url:"http://dataurl.net/#dataurlmaker"})},document.querySelector("#lorem_ipsum_generator_btn").onclick=function(){nexus.prototype.hide_all_menus(),nexus.show_popup({url:"http://www.blindtextgenerator.com/lorem-ipsum"})}},export_to_codepen:function(){if(!nexus.prototype.has_user_code())return void nexus.show_error("No Code To Share");nexus.show_error("has user code");var e=document.createElement("form");e.style.display="none",e.target="_blank",e.method="POST",e.action="http://codepen.io/pen/define";var t=e.appendChild(document.createElement("input"));t.type="hidden",t.name="data",data_obj={title:nexus.prototype.get_filename(),html:document.querySelector(".code_box.html").value()||"",css:document.querySelector(".code_box.css").value()||"",js:document.querySelector(".code_box.js").value()||""},t.value=JSON.stringify(data_obj).replace(/"/g,"&quot;").replace(/'/g,"&apos;"),e.submit()},get_preview_code:function(){for(var e="",t=0;t<nexus.prototype.code_boxes.length;t++){var o=nexus.prototype.code_boxes[t];""!=o.editor.getValue().trim()&&(e+="\n<"+nexus.prototype.settings.editors.languages[o.language].tag+" id='nexus_prototype_preview_"+o.language+"' >\n"+o.editor.getValue()+"\n</"+nexus.prototype.settings.editors.languages[o.language].tag+">\n")}return nexus.prototype.settings.include_jquery&&(e="<script src=jquery.js></script>"+e),e},has_user_code:function(){for(var e=0;e<nexus.prototype.code_boxes.length;e++)if(""!=nexus.prototype.code_boxes[e].value())return!0;return!1},local_functionality_notice:function(){},toggle_main_menu:function(){$("#main_menu_toggle").toggleClass("fa-bars fa-times"),document.querySelector("#share_menu_toggle").className="fa fa-share action",$("#main_menu").toggleClass("active"),$("#share_menu").removeClass("active"),document.querySelector("#main_menu_toggle.fa-times")?nexus.show_mask():nexus.hide_mask()},toggle_share_menu:function(){document.querySelector("#main_menu_toggle").className="fa fa-bars action",$("#share_menu").toggleClass("active"),$("#main_menu").removeClass("active"),$("#share_menu_toggle").toggleClass("fa-share fa-times"),document.querySelector("#share_menu_toggle.fa-times")?nexus.show_mask():nexus.hide_mask()},editor_width_min:function(){nexus.prototype.code_boxes_container.style.width="0",preview.style.width="calc(100% - "+nexus.prototype.code_boxes_container.style.width+")"},editor_width_max:function(){nexus.prototype.code_boxes_container.style.width="100%",preview.style.width="calc(100% - "+nexus.prototype.code_boxes_container.style.width+")"},get_functionality:function(){var e=document.querySelector("#open_btn"),t=document.querySelector("#export_codepen");document.domain?t.addEventListener("click",nexus.prototype.export_to_codepen,!1):(t.addEventListener("click",nexus.prototype.local_functionality_notice,!1),e.type="button",e.addEventListener("click",nexus.prototype.local_functionality_notice,!1)),"chrome_app"==nexus.prototype["interface"]||(window.onbeforeunload=function(){return"All your work will be erased!"}),"chrome_app"==nexus.prototype["interface"]&&nexus.link("nexus.prototype_chrome_app.css")},"import":function(e){nexus.prototype.reset(),null!=e&&(nexus.prototype.set_filename(e.name),$(document.querySelector("html")).addClass("importing"),nexus.file.read(e).then(function(e){document.querySelector(".code_box.html").set_value(e),$(document.querySelector("html")).removeClass("importing"),nexus.hide_mask(!0)}))},import_from_codepen:function(e){if(e=e||window.prompt("Paste codepen url..."),!e)return void sonsole.error("No URL supplied");var t=e.replace("http://codepen.io/","");t=t.substring(0,t.indexOf("/pen"));var o=e.substring(e.lastIndexOf("/")+1,e.length),n=document.body.appendChild(document.createElement("iframe"));n.contentDocument||n.contentWindow.document;n.className="cp_embed_iframe codepen",n.id="cp_embed_"+o,n.src="//codepen.io/"+t+"/embed/"+o+"?slug-hash="+o+"&amp;user="+t,n.setAttribute("scrolling","no"),n.setAttribute("frameborder","0"),n.setAttribute("height",parseInt(window.getComputedStyle(nexus.prototype.preview_frame).height)),n.setAttribute("style","width:100%;min-height:100%;"),n.setAttribute("allowtransparency","true"),n.setAttribute("allowfullscreen","true"),document.querySelector(".code_area.html").value=n.outerHTML,n.parentNode.removeChild(n)},open:function(){nexus.prototype["import"](document.querySelector("#open_btn").files[0])},refresh_code_boxes:function(){for(var e=0;e<nexus.prototype.code_boxes.length;e++)nexus.prototype.code_boxes[e].refresh()},reset:function(){nexus.prototype.set_filename("prototype.html");for(var e=0;e<nexus.prototype.code_boxes.length;e++)nexus.prototype.code_boxes[e].set_value(""),nexus.prototype.code_boxes[e].querySelector(".code_box_toggler").setAttribute("checked","checked");nexus.prototype.hide_all_menus(),nexus.prototype.resize_code_boxes(),nexus.prototype.code_boxes_container.removeAttribute("style"),nexus.prototype.preview_container.removeAttribute("style"),nexus.hide_mask(!0)},resize_code_boxes:function(){for(var e=new Array,t=0;t<nexus.prototype.code_boxes.length;t++)nexus.prototype.code_boxes[t].querySelector(".code_box_toggler").checked?e.push(nexus.prototype.code_boxes[t]):nexus.prototype.code_boxes[t].style.height="";for(var o=nexus.prototype.code_boxes.length-e.length,t=0;t<e.length;t++)e[t].style.height="calc((100% - 25px*"+o+")/"+e.length+")",setTimeout(function(e){e.refresh()},300,e[t])},show_about:function(){nexus.prototype.hide_all_menus(),nexus.show_popup({url:"about.html"})},show_settings:function(){nexus.prototype.hide_all_menus(),nexus.show_popup({url:"settings.html"})},show_preview:function(){nexus.prototype.last_updated=new Date,setTimeout(function(e){var t=new Date;if(!(Math.abs((t.getTime()-nexus.prototype.last_updated.getTime())/1e3)<nexus.prototype.settings.preview_delay))if(console.clear(),"chrome_app"==nexus.prototype["interface"]){for(var o=0,n=null;o<nexus.prototype.code_boxes.length;o++)n=nexus.prototype.code_boxes[o];chrome.storage.local.set({preview:nexus.prototype.get_preview_code()})}else{var r=nexus.prototype.preview_frame,s=r.contentDocument||r.contentWindow.document;s.open(),s.write(nexus.prototype.get_preview_code()),s.close()}},1e3*nexus.prototype.settings.preview_delay,event)},hide_all_menus:function(){$("#main_menu").removeClass("active"),$("#share_menu").removeClass("active"),document.querySelector("#main_menu_toggle").className="fa fa-bars action",document.querySelector("#share_menu_toggle").className="fa fa-share action",nexus.hide_mask()},set_filename:function(e){document.querySelector("#filename").value=e},get_filename:function(){var e=document.querySelector("#filename").value;return e},save:function(){var e="data:application/xml;charset=utf-8,"+encodeURIComponent(nexus.prototype.get_preview_code());document.querySelector("#download_btn").download=nexus.prototype.get_filename(),document.querySelector("#download_btn").href=e},send_via:{email:function(){document.querySelector("#export_email").href="mailto:?subject=Prototype&body="+encodeURIComponent(nexus.prototype.get_preview_code())}},settings:{save:function(){nexus.prototype.settings.preview_delay=document.querySelector("[name=preview_delay]")?parseInt(document.querySelector("[name=preview_delay]").value):0},editors:{languages:{js:{tag:"script",session:"ace/mode/javascript",media_type:"application/javascript"},css:{tag:"style",session:"ace/mode/css",media_type:"text/css"},html:{tag:"body",session:"ace/mode/html",media_type:"text/html"}},show_indent_guides:!0,theme:"ace/theme/chrome","default":["html","css","js"]},include_jquery:!1,include_font_awesome:!1,preview_time:0,update:function(){console.debug("settings updated"),nexus.prototype.settings.include_jquery=document.querySelector("input[type=checkbox][name=include_jquery]").checked}},editor_width:null,resize_start:null,init_resize_functionality:function(){nexus.prototype.resize_bar.addEventListener("mousedown",function(e){$(document.body).addClass("resizing"),nexus.prototype.resize_start=e.clientX,nexus.prototype.editor_width=parseInt(window.getComputedStyle(nexus.prototype.code_boxes_container).width)},!1),nexus.prototype.resize_bar.addEventListener("contextmenu",function(){$(document.body).removeClass("resizing")},!1),document.addEventListener("mouseup",function(){$(document.body).hasClass("resizing")&&($(document.body).removeClass("resizing"),nexus.prototype.refresh_code_boxes())},!1),document.addEventListener("mousemove",function(e){if(document.querySelector("body.resizing")){var t=parseInt(window.getComputedStyle(nexus.prototype.workspace).width),o=(parseInt(window.getComputedStyle(nexus.prototype.resize_bar).width),e.clientX-nexus.prototype.resize_start),n=(nexus.prototype.editor_width+o)/t*100;nexus.prototype.code_boxes_container.style.width=n+"%",nexus.prototype.preview_container.style.width="calc(100% - "+nexus.prototype.code_boxes_container.style.width+")"}},!1)},init:function(){nexus.prototype.construct(),new nexus.dropzone(document.querySelector("html"));new nexus.dropzone(document.querySelector(".mask"),{accept:["js","css","html"],ondrop:function(e){document.querySelector("html").remove_drag_states(),nexus.prototype["import"](e)},ondragenter:nexus.prototype.hide_all_menus});ace.require("ace/ext/language_tools"),chrome&&chrome.storage&&(nexus.prototype["interface"]="chrome_app"),nexus.prototype.code_boxes_container=document.querySelector("#code_boxes_container"),nexus.prototype.preview_container=document.querySelector("#preview_container"),nexus.prototype.preview_frame=nexus.prototype.preview_container.querySelector("iframe"),nexus.prototype.resize_bar=document.querySelector("#resize_bar"),nexus.prototype.workspace=document.querySelector("#workspace");for(var e=0;e<nexus.prototype.settings.editors["default"].length;e++)nexus.prototype.code_boxes_container.appendChild(new nexus.prototype.code_box(nexus.prototype.settings.editors["default"][e]));nexus.prototype.code_boxes[0].editor.focus(),document.querySelector(".reset").addEventListener("click",nexus.prototype.reset,!1),document.querySelector("#export_codepen").addEventListener("click",nexus.prototype.export_to_codepen,!1),document.querySelector("#download_btn").addEventListener("click",nexus.prototype.save,!1),document.querySelector("#main_menu_toggle").addEventListener("click",nexus.prototype.toggle_main_menu,!1),document.querySelector("#share_menu_toggle").addEventListener("click",nexus.prototype.toggle_share_menu,!1),document.querySelector("#btn_editor_min").addEventListener("click",nexus.prototype.editor_width_min,!1),document.querySelector("#btn_editor_max").addEventListener("click",nexus.prototype.editor_width_max,!1),document.querySelector("#export_email").addEventListener("click",nexus.prototype.send_via.email,!1),nexus.prototype.catch_save(),nexus.prototype.catch_open(),document.querySelector("#open_btn").onchange=nexus.prototype.open,document.querySelector("#share_btn").addEventListener("click",nexus.prototype.toggle_share_menu,!1),document.querySelector("#about_btn").addEventListener("click",nexus.prototype.show_about,!1),document.querySelector("#settings_btn").addEventListener("click",nexus.prototype.show_settings,!1),document.querySelector("#toggle_grid").addEventListener("click",function(){$(document.body).toggleClass("grid")},!1),nexus.prototype.code_boxes=document.querySelectorAll(".code_box"),nexus.prototype.form=document.querySelector("#main"),nexus.prototype.init_resize_functionality(),nexus.prototype.get_functionality(),nexus.prototype.resize_code_boxes(),$(document.body).removeClass("initializing")}},document.addEventListener("DOMContentLoaded",function(){nexus.prototype.init()},!1);